<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sell Your Watch</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}

.sell-form {
  background: #111;
  padding: 30px 25px;
  border-radius: 10px;
  width: 100%;
  max-width: 420px;
  margin-top: 40px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.7);
}

.sell-form h3 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 20px;
  border-bottom: 1px solid #222;
  padding-bottom: 5px;
}

.sell-form label {
  display: block;
  font-size: 14px;
  margin-top: 12px;
  margin-bottom: 5px;
}

.sell-form input,
.sell-form textarea,
.sell-form select {
  width: 100%;
  padding: 10px 12px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #1b1b1b;
  color: #fff;
  font-size: 14px;
  margin-bottom: 10px;
}

.sell-form textarea {
  resize: vertical;
}

.sell-form button {
  width: 100%;
  padding: 12px;
  background: #0099ff;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 10px;
}
</style>
</head>

<body>

<form class="sell-form">

  <h3>Watch Details</h3>

  <label>Description</label>
  <textarea id="description" placeholder="Shkruaj përshkrimin..."></textarea>

  <!-- FOTO -->
  <button id="chooseBtn" type="button">Upload Photos</button>
  <input id="photoFiles" type="file" accept="image/*" multiple
         style="position:absolute; left:-9999px; opacity:0;">

  <button id="uploadBtn" type="button" disabled>NGARKO FOTOT</button>

  <div id="msg"></div>

</form>

<!-- SCRIPT POSHTË FARE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyACmJj1OGz1gfRUjxz-w3_k94tNBfNyvVg",
  authDomain: "oraswiss-27e57.firebaseapp.com",
  projectId: "oraswiss-27e57",
  storageBucket: "oraswiss-27e57.firebasestorage.app",
  messagingSenderId: "596627676936",
  appId: "1:596627676936:web:0c96cf820fef4e979616bd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const storage = getStorage(app);

const chooseBtn = document.getElementById("chooseBtn");
const fileInput = document.getElementById("photoFiles");
const uploadBtn = document.getElementById("uploadBtn");
const msg = document.getElementById("msg");

let currentUser = null;

/* AUTH */
onAuthStateChanged(auth, (user) => {
  currentUser = user;
});

/* OPEN FILE PICKER */
chooseBtn.onclick = () => {
  fileInput.click();
};

/* FILE SELECT */
fileInput.onchange = () => {
  const n = fileInput.files.length;
  if (n > 0) {
    msg.textContent = ✅ Zgjodhe ${n} foto;
    uploadBtn.disabled = false;
  } else {
    uploadBtn.disabled = true;
  }
};

/* UPLOAD */
uploadBtn.onclick = async () => {
  try {
    if (!currentUser) throw new Error("Duhet të jesh i loguar");
    if (!fileInput.files.length) throw new Error("Zgjidh foto");

    msg.textContent = "⏳ Duke ngarkuar...";

    const urls = [];
    for (const file of fileInput.files) {
      const path = sellnow/${currentUser.uid}/${Date.now()}_${file.name};
      const fileRef = ref(storage, path);
      await uploadBytes(fileRef, file);
      const url = await getDownloadURL(fileRef);
      urls.push(url);
    }

    msg.textContent = "✅ Foto u ngarkuan: " + urls.length;
    console.log("PHOTO URLS:", urls);

  } catch (e) {
    msg.textContent = "❌ " + e.message;
  }
};
</script>

</body>
</html>
