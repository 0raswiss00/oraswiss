<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sell Now</title>

  <style>
    body{font-family:Arial,sans-serif;background:#0b0b0b;color:#fff;margin:0;padding:20px}
    .wrap{max-width:900px;margin:0 auto}
    .top{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:820px){.row{grid-template-columns:1fr}}
    label{display:block;margin:12px 0 6px;color:#ddd}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#111;color:#fff}
    textarea{min-height:90px}
    .btn{margin-top:14px;padding:10px 12px;border-radius:12px;border:1px solid #2a2a2a;background:#0f0f0f;color:#fff;cursor:pointer}
    .btn:hover{background:#1a1a1a}
    .note{opacity:.85;font-size:13px;margin-top:8px;line-height:1.4}
    pre{background:#111;border:1px solid #222;border-radius:12px;padding:12px;overflow:auto}
    .smallbtn{padding:8px 10px;border-radius:12px;border:1px solid #2a2a2a;background:#0f0f0f;color:#fff;cursor:pointer}
    .smallbtn:hover{background:#1a1a1a}
  .sell-btn {
    display: inline-block;
    margin-top: 16px;
    padding: 14px 22px;
    background: #25D366;
    color: white;
    font-weight: bold;
    border-radius: 6px;
    text-decoration: none;
  }
  .sell-btn:hover {
    background: #1ebe5d;
  }
  </style>  

  <!-- Password (client-side) -->
  <script>
    const PASS = "1234"; // ndrysho password
    const KEY = "sellnow_ok";
    if (localStorage.getItem(KEY) !== "1") {
      const p = prompt("Password:");
      if (p === PASS) localStorage.setItem(KEY,"1");
      else { alert("Wrong password"); location.href="index.html"; }
    }
  </script>

  <!-- Cloudinary Upload Widget -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
</head>

<body>
<div class="wrap">

  <div class="top">
    <h1 style="margin:0">Sell Now</h1>
    <button class="smallbtn" id="logout" type="button">Logout</button>
  </div>

  <div class="note">
    ✅ Upload Photos ngarkon foto REALISHT nga telefoni/PC dhe i vendos URL-të automatikisht te <b>photos</b>.
  </div>

  <label>Category</label>
  <select id="cat">
    <option value="luxury">Luxury</option>
    <option value="vintage" selected>Vintage</option>
    <option value="parts">Parts</option>
  </select>

  <div class="row">
    <div><label>Brand</label><input id="brand" placeholder="Omega"></div>
    <div><label>Model</label><input id="model" placeholder="Vintage"></div>
  </div>

  <div class="row">
    <div><label>Ref</label><input id="ref" placeholder="2400-4"></div>
    <div><label>Year</label><input id="year" placeholder="1999"></div>
  </div>

  <div class="row">
    <div><label>Material</label><input id="material" placeholder="Steel"></div>
    <div><label>Case Size (mm)</label><input id="caseSize" placeholder="35"></div>
  </div>

  <div class="row">
    <div>
      <label>Condition</label>
      <select id="condition">
        <option>New</option>
        <option>Like New</option>
        <option selected>Very Good</option>
        <option>Good</option>
        <option>Used - Fair</option>
      </select>
    </div>
    <div><label>Price</label><input id="price" placeholder="900 €"></div>
  </div>

  <label>Description</label>
  <textarea id="description" placeholder="Original, serviced"></textarea>

  <label>Photos (URLs)</label>
  <button class="btn" id="uploadBtn" type="button">Upload Photos</button>
  <textarea id="photos" placeholder="URL-të e fotove do dalin këtu, me presje"></textarea>
  <a
    href="https://wa.me/355692408065?text=Hello%20dua%20te%20shes%20nje%20ore"
    class="sell-btn"
    target="_blank"

    SELL NOW
  </a>
  <div class="note">
    Nëse s’po hapet widget-i: Cloud name / upload preset janë gabim.
  </div>

  <button class="btn" id="make" type="button">Generate JSON</button>

  <h3 style="margin:18px 0 8px">Copy this into watches.json</h3>
  <pre id="out">Kliko "Generate JSON"</pre>
  <button class="btn" id="copy" type="button">Copy</button>

</div>

<script>
const $ = id => document.getElementById(id);
const parse = t => (t||"").split(/[\n,]+/g).map(s=>s.trim()).filter(Boolean);

// LOGOUT
$("logout").onclick = ()=>{
  localStorage.removeItem("sellnow_ok");
  location.href="index.html";
};

// CLOUDINARY CONFIG (zëvendëso këto 2 vlera)
const CLOUD_NAME = "oraswiss";
const UPLOAD_PRESET = "sellnow";

// UPLOAD BUTTON
$("uploadBtn").onclick = ()=>{
  if (!CLOUD_NAME.includes("PASTE") && !UPLOAD_PRESET.includes("PASTE")) {
    cloudinary.openUploadWidget(
      {
        cloudName: CLOUD_NAME,
        uploadPreset: UPLOAD_PRESET,
        multiple: true,
        sources: ["local","camera"],
        folder: "products"
      },
      (err, result) => {
        if (err) {
          alert("Upload error");
          console.error(err);
          return;
        }
        if (result && result.event === "success") {
          const ta = $("photos");
          const urls = parse(ta.value);
          urls.push(result.info.secure_url);
          ta.value = urls.join(", ");
        }
      }
    );
  } else {
    alert("Vendos CLOUD_NAME dhe UPLOAD_PRESET te kodi.");
  }
};

// JSON GENERATOR
$("make").onclick = ()=>{
  const item = {
    id: Date.now(),
    cat: ($("cat").value||"").toLowerCase().trim(),
    brand: $("brand").value.trim(),
    model: $("model").value.trim(),
    ref: $("ref").value.trim(),
    year: $("year").value.trim(),
    material: $("material").value.trim(),
    caseSize: $("caseSize").value.trim(),
    condition: $("condition").value,
    price: $("price").value.trim(),
    description: $("description").value.trim(),
    photos: parse($("photos").value)
  };
  $("out").textContent = JSON.stringify(item, null, 2);
};

// COPY
$("copy").onclick = async ()=>{
  try { await navigator.clipboard.writeText($("out").textContent); alert("Copied ✅"); }
  catch { alert("Copy manualisht."); }
};
</script>
<script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

<script>
const widget = cloudinary.createUploadWidget(
  {
    cloudName: "drfjznv52",
    uploadPreset: "oraswiss_upload",
    folder: "watches",
    multiple: true
  },
  (error, result) => {
    if (!error && result && result.event === "success") {
      const textarea = document.getElementById("photos");
      textarea.value += result.info.secure_url + "\n";
    }
  }
);

document.getElementById("uploadBtn").addEventListener("click", () => {
  widget.open();
});
</script>

<script>
document.getElementById("sellNow").addEventListener("click", function (e) {
  const photos = document.getElementById("photos").value.trim();

  if (!photos) {
    e.preventDefault();
    alert("Duhet të ngarkosh të paktën një foto para se të shesësh.");
    return;
  }

  const brand = document.getElementById("brand").value;
  const model = document.getElementById("model").value;
  const price = document.getElementById("price").value;

  const message =
    Përshëndetje,%0A +
    Dua të shes një orë:%0A +
    Brand: ${brand}%0A +
    Model: ${model}%0A +
    Çmimi: ${price}€%0A%0A +
    Fotot:%0A${photos};

  this.href = https://wa.me/355692408065?text=${message};
});
</script>
  
</body>
</html>
