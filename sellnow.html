<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Add Watch</title>
  <style>
    body{font-family:Arial;background:#0b0b0b;color:#fff;margin:0;padding:20px}
    .wrap{max-width:700px;margin:auto}
    label{display:block;margin-top:12px;color:#ddd}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#111;color:#fff}
    textarea{min-height:90px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:820px){.row{grid-template-columns:1fr}}
    button{margin-top:16px;padding:14px 18px;border-radius:10px;border:none;font-weight:bold;cursor:pointer}
    #uploadBtn{background:#333;color:#fff}
    #publishBtn{background:#25D366;color:#000}
    .note{opacity:.85;font-size:13px;margin-top:10px;line-height:1.4}
    pre{background:#111;border:1px solid #222;border-radius:12px;padding:12px;overflow:auto;white-space:pre-wrap}
  </style>
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
</head>
<body>
<div class="wrap">
  <h2>Shto orë (Admin)</h2>

  <div class="row">
    <div><label>Brand</label><input id="brand" placeholder="Rolex"></div>
    <div><label>Model</label><input id="model" placeholder="Datejust"></div>
  </div>

  <div class="row">
    <div><label>Ref</label><input id="ref" placeholder="16233"></div>
    <div><label>Year</label><input id="year" placeholder="1999"></div>
  </div>

  <div class="row">
    <div>
      <label>Box & Papers</label>
      <select id="box">
        <option value="">Boshe</option>
        <option>With box & papers</option>
        <option>Box only</option>
        <option>Papers only</option>
        <option>No box & papers</option>
        <option>I don’t know</option>
      </select>
    </div>
    <div>
      <label>Working</label>
      <select id="working">
        <option value="">Boshe</option>
        <option>Working</option>
        <option>Not working</option>
        <option>I don’t know</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div><label>Price (€)</label><input id="price" placeholder="4500"></div>
    <div><label>Condition</label>
      <select id="condition">
        <option>New</option>
        <option>Like New</option>
        <option selected>Very Good</option>
        <option>Good</option>
        <option>Used - Fair</option>
      </select>
    </div>
  </div>

  <label>Description</label>
  <textarea id="description" placeholder="Shkruaj detaje..."></textarea>

  <label>Photos</label>
  <button id="uploadBtn" type="button">Upload Photos</button>
  <textarea id="photos" placeholder="URL-të dalin këtu" readonly></textarea>

  <button id="publishBtn" type="button">PUBLISH</button>

  <div class="note">Pasi të shtosh orën, hape <b>watches.html</b> dhe do shfaqet aty.</div>

  <h3 style="margin-top:18px">Last saved JSON (opsionale)</h3>
  <pre id="out">—</pre>
</div>

<script>
const STORAGE_KEY = "oraswiss_watches";

<script>
const $ = id => document.getElementById(id);

function loadWatches(){
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  } catch {
    return [];
  }
}

function saveWatches(list){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
}

$("publishBtn").onclick = () => {
  const photos = $("photos").value.trim();
  if (!photos) {
    alert("Duhet të ngarkosh të paktën një foto");
    return;
  }

  const item = {
    id: Date.now(),
    brand: $("brand")?.value || "",
    model: $("model")?.value || "",
    price: $("price")?.value || "",
    description: $("description")?.value || "",
    photos: photos.split(/\n|,/).map(p => p.trim()).filter(Boolean)
  };

  const list = loadWatches();
  list.unshift(item);
  saveWatches(list);

  alert("Ora u shtua me sukses ✅");
  location.href = "watches.html";
};
</script>
  
// Cloudinary (vendos këto të sakta)
const widget = cloudinary.createUploadWidget(
  {
    cloudName: "drfjznv52",
    uploadPreset: "oraswiss_upload",
    folder: "watches",
    multiple: true
  },
  (error, result) => {
    if (!error && result && result.event === "success") {
      const ta = document.getElementById("photos");
      ta.value += result.info.secure_url + "\n";
    }
  }
);

document.getElementById("uploadBtn").onclick = () => widget.open();

function loadList(){
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
  catch { return []; }
}
function saveList(list){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
}

document.getElementById("publishBtn").onclick = () => {
  const photos = document.getElementById("photos").value.trim().split("\n").map(s=>s.trim()).filter(Boolean);
  if (!photos.length) { alert("Ngarko të paktën 1 foto"); return; }

  const item = {
    id: Date.now(),
    brand: document.getElementById("brand").value.trim(),
    model: document.getElementById("model").value.trim(),
    ref: document.getElementById("ref").value.trim(),
    year: document.getElementById("year").value.trim(),
    price: document.getElementById("price").value.trim(),
    condition: document.getElementById("condition").value,
    box: document.getElementById("box").value,
    working: document.getElementById("working").value,
    description: document.getElementById("description").value.trim(),
    photos
  };

  const list = loadList();
  list.unshift(item); // e fundit del lart
  saveList(list);

  document.getElementById("out").textContent = JSON.stringify(item, null, 2);
  alert("U publikua ✅");
};
</script>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const SUPABASE_URL = "https://XXXX.supabase.co";
  const SUPABASE_ANON_KEY = "ANON_PUBLIC_KEY";

  const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );
</script>

<script>
document.getElementById("publishBtn").addEventListener("click", async () => {

  const photos = document.getElementById("photos").value
    .split(/\n|,/).map(p=>p.trim()).filter(Boolean);

  if (!photos.length) {
    alert("Ngarko të paktën 1 foto");
    return;
  }

  const data = {
    category: document.getElementById("category").value,
    brand: document.getElementById("brand").value,
    ref: document.getElementById("ref").value,
    model: document.getElementById("model").value,
    year: document.getElementById("year").value || null,
    material: document.getElementById("material").value,
    condition: document.getElementById("condition").value,
    description: document.getElementById("description").value,
    case_size: document.getElementById("case_size").value || null,
    price: document.getElementById("price").value || null,
    photos: photos.join(","),
    status: "pending"
  };

  const { error } = await supabase.from("watches").insert([data]);

  if (error) {
    alert("Gabim: " + error.message);
  } else {
    alert("Ora u dërgua ✔️ (pending)");
  }
});
</script>
  
</body>  
</html>
