<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sell Now</title>
  <style>
    body{font-family:Arial,sans-serif;background:#0b0b0b;color:#fff;margin:0;padding:20px}
    .wrap{max-width:900px;margin:0 auto}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:820px){.row{grid-template-columns:1fr}}
    label{display:block;margin:12px 0 6px;color:#ddd}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#111;color:#fff}
    textarea{min-height:90px}
    .btn{margin-top:14px;padding:10px 12px;border-radius:12px;border:1px solid #2a2a2a;background:#0f0f0f;color:#fff;cursor:pointer}
    .btn:hover{background:#1a1a1a}
    .note{opacity:.8;font-size:13px;margin-top:8px;line-height:1.4}
    pre{background:#111;border:1px solid #222;border-radius:12px;padding:12px;overflow:auto}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 10px">Sell Now</h1>
    <div class="note">
      Foto upload nga telefoni nuk ruhet në server. <br>
      Fotot duhet t’i ngarkosh te GitHub në folderin <b>/img</b>, pastaj këtu shkruan: <b>img/emri.jpg</b> (me presje).
    </div>

    <label>Category</label>
    <select id="cat">
      <option value="luxury">Luxury</option>
      <option value="vintage" selected>Vintage</option>
      <option value="parts">Parts</option>
    </select>

    <div class="row">
      <div>
        <label>Brand</label><input id="brand" placeholder="Rolex">
      </div>
      <div>
        <label>Model</label><input id="model" placeholder="Datejust">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Ref</label><input id="ref" placeholder="16013">
      </div>
      <div>
        <label>Year</label><input id="year" placeholder="1985">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Material</label><input id="material" placeholder="Steel / Gold">
      </div>
      <div>
        <label>Case Size (mm)</label><input id="caseSize" placeholder="36">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Condition</label>
        <select id="condition">
          <option>New</option>
          <option>Like New</option>
          <option selected>Very Good</option>
          <option>Good</option>
          <option>Used - Fair</option>
        </select>
      </div>
      <div>
        <label>Price</label><input id="price" placeholder="5,000 €">
      </div>
    </div>

    <label>Description</label>
    <textarea id="description" placeholder="Original dial, serviced"></textarea>

    <label>Photos (paths)</label>
    <textarea id="photos" placeholder="img/rolex1.jpg, img/rolex2.jpg"></textarea>

    <button class="btn" id="make">Generate JSON</button>

    <h3 style="margin:18px 0 8px">Copy this into watches.json</h3>
    <pre id="out">Click "Generate JSON"</pre>
    <button class="btn" id="copy">Copy</button>
    <div class="note">
      Pastaj: GitHub → watches.json → Edit → ngjite si objekt të ri brenda [ ... ] dhe Commit.
    </div>
  </div>

<script>
const JSON_URL = "watches.json";   // e njejta folder me shop-*.html
const CATEGORY = "vintage";        // ndrysho: "luxury" ose "parts"

const list = document.getElementById("list");

// kthen src korrekt per foto: base64, http, ose img/...
function fixSrc(s){
  s = (s || "").trim();
  if(!s) return "";
  if(s.startsWith("data:image/")) return s;          // ✅ Base64 nga telefoni
  if(s.startsWith("http://") || s.startsWith("https://")) return s;
  if(s.startsWith("/")) return s;
  return s; // p.sh. "img/rolex1.jpg" (relativ ne te njejtin domain)
}

function esc(s){
  return (s ?? "").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

function render(items){
  const filtered = (items || []).filter(p => (p.cat || "").toLowerCase() === CATEGORY);
  if(!filtered.length){
    list.innerHTML = <p>No products found.</p>;
    return;
  }

  list.innerHTML = filtered.map(p=>{
    const photos = Array.isArray(p.photos) ? p.photos.map(fixSrc).filter(Boolean) : [];
    const main = photos[0] || "";
    const thumbs = photos.map(ph => <img class="thumb" src="${ph}" alt="">).join("");

    return `
      <section class="card">
        <div>
          ${main ? <img class="main" src="${main}" alt=""> : `<div class="panel">No photo</div>`}
          ${thumbs ? <div class="thumbs">${thumbs}</div> : ``}
        </div>

        <div class="panel">
          <div><b>${esc(p.brand)}</b> ${esc(p.model)}</div>
          <div>Ref: ${esc(p.ref)} | Year: ${esc(p.year)}</div>
          <div>${esc(p.material)} | ${esc(p.caseSize)}mm | ${esc(p.condition)}</div>
          <div style="margin-top:6px"><b>${esc(p.price)}</b></div>
          <div style="margin-top:6px">${esc(p.description)}</div>
        </div>
      </section>
    `;
  }).join("");

  // thumbs -> main image
  document.querySelectorAll(".card").forEach(card=>{
    const mainImg = card.querySelector("img.main");
    card.querySelectorAll("img.thumb").forEach(t=>{
      t.addEventListener("click", ()=>{ if(mainImg) mainImg.src = t.src; });
    });
  });
}

async function load(){
  try{
    const res = await fetch(JSON_URL + "?v=" + Date.now(), { cache: "no-store" });
    if(!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();

    const items = Array.isArray(data) ? data : (data.items || []);
    render(items);
  }catch(err){
    console.error("Failed to load JSON:", err);
    list.innerHTML = <p>Error loading products.</p>;
  }
}

window.addEventListener("DOMContentLoaded", load);
</script>

</body>
</html>
