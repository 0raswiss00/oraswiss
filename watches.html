<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ora | OraSwiss</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0b0b0b;
      color: #fff;
    }
    .wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    .back {
      margin-bottom: 20px;
      display: inline-block;
      color: #c9a24d;
      text-decoration: none;
    }
    .gallery img {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    h1 {
      margin: 10px 0;
    }
    .price {
      font-size: 22px;
      color: #c9a24d;
      margin: 10px 0;
    }
    .meta {
      opacity: .9;
      line-height: 1.6;
    }
  </style>
</head>

<body>

<script>
/* ❌ ÇAKTIVIZO SERVICE WORKER (kritike për Safari) */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.getRegistrations()
    .then(rs => rs.forEach(r => r.unregister()));
}
</script>

<div class="wrap">
  <a class="back" href="index.html">← Kthehu</a>

  <div id="content">Po ngarkohet…</div>
</div>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://XXXX.supabase.co";   // ← VENDOS KËTU
const SUPABASE_ANON_KEY = "XXXX";                  // ← VENDOS KËTU
const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* Merr ID nga URL */
const params = new URLSearchParams(window.location.search);
const watchId = params.get("id");

const content = document.getElementById("content");

if (!watchId) {
  content.textContent = "ID mungon.";
  throw new Error("Missing ID");
}

/* Ndihmë: foto e parë */
function photosArray(p) {
  if (!p) return [];
  if (Array.isArray(p)) return p;
  return String(p).split(/\n|,/).map(x => x.trim()).filter(Boolean);
}

async function loadWatch() {
  const { data, error } = await supabase
    .from("watches")
    .select("*")
    .eq("id", watchId)
    .single();

  if (error || !data) {
    content.textContent = "Ora nuk u gjet.";
    console.error(error);
    return;
  }

  const photos = photosArray(data.photos);

  content.innerHTML = `
    <div class="gallery">
      ${photos.map(p => <img src="${p}" alt="">).join("")}
    </div>

    <h1>${data.brand || ""} ${data.model || ""}</h1>

    <div class="price">
      ${data.price ? data.price + " €" : ""}
    </div>

    <div class="meta">
      ${data.ref ? "<b>Ref:</b> " + data.ref + "<br>" : ""}
      ${data.year ? "<b>Year:</b> " + data.year + "<br>" : ""}
      ${data.material ? "<b>Material:</b> " + data.material + "<br>" : ""}
      ${data.case_size ? "<b>Case:</b> " + data.case_size + " mm<br>" : ""}
      ${data.condition ? "<b>Condition:</b> " + data.condition + "<br>" : ""}
      ${data.box ? "<b>Box & Papers:</b> " + data.box + "<br>" : ""}
      ${data.working ? "<b>Working:</b> " + data.working + "<br>" : ""}
    </div>

    <p style="margin-top:15px">
      ${data.description || ""}
    </p>
  `;
}

loadWatch();
</script>

</body>
</html>
