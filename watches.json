[
  {
    "cat": "vintage",
    "brand": "Rolex",
    "model": "Datejust",
    "ref": "16013",
    "year": "1985",
    "material": "Steel / Gold",
    "caseSize": "36",
    "condition": "Very Good",
    "price": "5,000 €",
    "description": "Original dial, serviced",
    "photos": [
      "img/rolex1.jpg",
      "img/rolex2.jpg"
    ]
  }
]

<script>
const JSON_URL = "watches.json";      // duhet të ekzistojë te root
const CATEGORY = "vintage";           // vintage / luxury / parts
const PHONE = "355692408065";
const EMAIL = "adice1899@gmail.com";

function esc(s){ return (s ?? "").toString(); }
function enc(s){ return encodeURIComponent(esc(s)); }

const list = document.getElementById("list");

function renderItems(items){
  const filtered = (items || []).filter(p => (p.cat||"").toLowerCase() === CATEGORY);

  if (!filtered.length) {
    list.innerHTML = `
      <section class="card">
        <div class="panel">No products yet. Add from SellNow / watches.json.</div>
      </section>
    `;
    return;
  }

  list.innerHTML = filtered.map(p => {
    const photos = Array.isArray(p.photos) ? p.photos : [];
    const main = photos[0] || "";

    const msg =
`Hello, I am interested in:
Brand: ${esc(p.brand)}
Model: ${esc(p.model)}
Ref: ${esc(p.ref)}
Year: ${esc(p.year)}
Price: ${esc(p.price)}
`;

    const wa = https://wa.me/${PHONE}?text=${enc(msg)};
    const mail = mailto:${EMAIL}?subject=${enc("Watch Inquiry: " + (p.brand||"") + " " + (p.model||""))}&body=${enc(msg)};

    return `
      <section class="card">
        <div>
          <img class="main" src="${main}" alt="">
          <div class="thumbs">
            ${photos.map(ph => <img class="thumb" src="${ph}" alt="">).join("")}
          </div>
        </div>

        <div class="panel">
          <h2 class="title">${esc(p.brand)} ${esc(p.model)}</h2>

          <div class="spec"><b>Ref</b><span>${esc(p.ref)}</span></div>
          <div class="spec"><b>Year</b><span>${esc(p.year)}</span></div>
          <div class="spec"><b>Material</b><span>${esc(p.material)}</span></div>
          <div class="spec"><b>Case</b><span>${esc(p.caseSize)} mm</span></div>
          <div class="spec"><b>Condition</b><span>${esc(p.condition)}</span></div>
          <div class="spec"><b>Price</b><span>${esc(p.price)}</span></div>

          <p class="desc">${esc(p.description)}</p>

          <div class="actions">
            <a class="btn" target="_blank" href="${wa}">WhatsApp</a>
            <a class="btn" href="${mail}">Email</a>
          </div>
        </div>
      </section>
    `;
  }).join("");

  // klik te thumbnails -> ndryshon foton kryesore
  document.querySelectorAll(".card").forEach(card => {
    const mainImg = card.querySelector(".main");
    card.querySelectorAll(".thumb").forEach(t => {
      t.addEventListener("click", () => { mainImg.src = t.src; });
    });
  });
}

async function load(){
  try {
    const r = await fetch(JSON_URL, { cache: "no-store" });
    if (!r.ok) throw new Error("Cannot load " + JSON_URL + " (HTTP " + r.status + ")");

    const data = await r.json();

    // lejon te dy formatet:
    // 1) [ ... ]
    // 2) { "items": [ ... ] }
    const items = Array.isArray(data) ? data : (data.items || []);

    renderItems(items);
  } catch (e) {
    list.innerHTML = `
      <section class="card">
        <div class="panel">
          ERROR: ${esc(e.message)}<br>
          Kontrollo që watches.json është në root dhe është JSON valid.
        </div>
      </section>
    `;
  }
}

load();
</script>

