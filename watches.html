<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ora Swiss - Watches</title>

  <style>
    body{font-family:Arial,sans-serif;background:#0b0b0b;color:#fff;margin:0;padding:20px}
    .wrap{max-width:1100px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid #222;background:#111;border-radius:16px;overflow:hidden}
    .img{width:100%;aspect-ratio:4/3;object-fit:cover;background:#000}
    .pad{padding:12px}
    .title{font-weight:800;margin-bottom:6px}
    .meta{opacity:.85;font-size:13px;line-height:1.35}
    .price{margin-top:8px;font-weight:800}
    .note{opacity:.85;font-size:13px;margin:10px 0}
  </style>
</head>

<body>
<div class="wrap">
  <h2 style="margin:0 0 8px">Watches</h2>
  <div class="note" id="status">Po ngarkon...</div>
  <div id="grid" class="grid"></div>
</div>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://xxxx.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const firstPhoto = (photos) => {
    if (!photos) return "";
    if (Array.isArray(photos)) return (photos[0] || "").trim();
    // fallback nëse diku vjen string
    return String(photos).split(/\n|,/g)[0]?.trim() || "";
  };

  async function loadWatches() {
    const statusEl = document.getElementById("status");
    const grid = document.getElementById("grid");
    statusEl.textContent = "Po ngarkon...";

    const { data, error } = await supabaseClient
      .from("watches")
      .select("*")
      .eq("status", "approved")
      .order("created_at", { ascending: false });

    if (error) {
      statusEl.textContent = "Gabim: " + error.message;
      console.error(error);
      return;
    }

    if (!data || data.length === 0) {
      statusEl.textContent = "S’ka ora për momentin.";
      grid.innerHTML = "";
      return;
    }

    statusEl.textContent = "";
    grid.innerHTML = data.map(w => {
      const img = firstPhoto(w.photos);
      return `
        <a class="card" href="watch.html?id=${w.id}">
          <div class="thumb">${img ? <img src="${img}" alt=""> : ""}</div>
          <div class="meta">
            <div class="t">${(w.brand || "")} ${(w.model || "")}</div>
            <div class="p">${w.price ? w.price + " €" : ""}</div>
          </div>
        </a>
      `;
    }).join("");
  }

  loadWatches();
</script>

</body>
</html>
