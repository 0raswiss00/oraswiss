<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vintage Watches</title>

  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#0b0b0b;color:#fff;padding:20px}
    h1{margin:0 0 14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;overflow:hidden}
    .main{width:100%;height:260px;object-fit:cover;background:#000;display:block}
    .thumbs{display:flex;gap:8px;flex-wrap:wrap;padding:10px;border-top:1px solid #2a2a2a}
    .thumb{width:54px;height:54px;object-fit:cover;border-radius:8px;border:1px solid #333;cursor:pointer}
    .panel{padding:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;opacity:.92;font-size:14px}
    .price{font-size:18px;margin:10px 0 0}
  </style>
</head>

<body>
  <h1>Vintage Watches</h1>

  <div id="list" class="grid"></div>

  <script>
    const JSON_URL = "watches.json";     // duhet të jetë NË ROOT
    const CATEGORY = "vintage";

    const list = document.getElementById("list");

    function esc(s){ return (s ?? "").toString(); }

    function render(items){
      const filtered = (items || []).filter(p => (p.cat || "").toLowerCase() === CATEGORY);

      if(!filtered.length){
        list.innerHTML = "<p>No products found.</p>";
        return;
      }

      list.innerHTML = filtered.map((p, idx) => {
        const photos = Array.isArray(p.photos) ? p.photos : [];
        const main = photos[0] || "";

        return `
          <section class="card" data-i="${idx}">
            <img class="main" src="${main}" alt="">
            <div class="thumbs">
              ${photos.map(ph => <img class="thumb" src="${ph}" alt="">).join("")}
            </div>
            <div class="panel">
              <div class="row"><b>${esc(p.brand)}</b> ${esc(p.model)} • Ref: ${esc(p.ref)} • Year: ${esc(p.year)}</div>
              <div class="row">Material: ${esc(p.material)} • Size: ${esc(p.caseSize)} • Condition: ${esc(p.condition)}</div>
              <div class="price"><b>€${esc(p.price)}</b></div>
              <div class="row" style="margin-top:8px">${esc(p.description)}</div>
            </div>
          </section>
        `;
      }).join("");

      // thumbs -> main image
      document.querySelectorAll(".card").forEach(card=>{
        const mainImg = card.querySelector(".main");
        card.querySelectorAll(".thumb").forEach(t=>{
          t.addEventListener("click", ()=>{ mainImg.src = t.src; });
        });
      });
    }

    async function load(){
      try{
        const res = await fetch(JSON_URL + "?v=" + Date.now(), { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        const items = Array.isArray(data) ? data : (data.items || []);
        render(items);
      }catch(err){
        console.error("Failed to load JSON:", err);
        list.innerHTML = "<p>Error loading products.</p>";
      }
    }

    load();
  </script>
</body>
</html>

