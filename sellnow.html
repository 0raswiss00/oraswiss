<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload Foto - Firebase</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 16px; }
    button { padding: 10px 14px; margin-right: 8px; margin-top: 8px; }
    #msg { margin-top: 12px; white-space: pre-line; }
  </style>
</head>
<body>

  <!-- INPUT (i fshehur) -->
  <input
    id="photoFiles"
    type="file"
    accept="image/*"
    multiple
    style="position:absolute; left:-9999px;"
  />

  <div>
    <button id="chooseBtn" type="button">ZGJIDH FOTOT</button>
    <button id="uploadBtn" type="button">NGARKO FOTOT</button>
    <button id="publishBtn" type="button">PUBLISH</button>
  </div>

  <div id="msg"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // âœ… VENDOS KONFIGURIMIN TÃ‹ND TÃ‹ SAKTÃ‹ (pa "â€¦")
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "oraswiss-27e57.firebaseapp.com",
      projectId: "oraswiss-27e57",
      storageBucket: "oraswiss-27e57.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);

    const chooseBtn = document.getElementById("chooseBtn");
    const fileInput = document.getElementById("photoFiles");
    const uploadBtn = document.getElementById("uploadBtn");
    const publishBtn = document.getElementById("publishBtn");
    const msg = document.getElementById("msg");

    let uploadedUrls = []; // URL-tÃ« pas upload

    function setMsg(t) {
      msg.textContent = t;
    }

    function setBusy(isBusy) {
      chooseBtn.disabled = isBusy;
      uploadBtn.disabled = isBusy;
      publishBtn.disabled = isBusy;
    }

    // âœ… Hap file picker
    chooseBtn.addEventListener("click", () => {
      fileInput.click();
    });

    // âœ… Kur zgjedh foto
    fileInput.addEventListener("change", () => {
      uploadedUrls = []; // nÃ«se zgjedh pÃ«rsÃ«ri, i pastrojmÃ« url-tÃ« e vjetra
      const n = fileInput.files.length;
      if (n === 0) {
        setMsg("Sâ€™u zgjodh asnjÃ« foto.");
      } else {
        setMsg(ğŸ“‚ U zgjodhÃ«n ${n} foto.\nTani shtyp â€œNGARKO FOTOTâ€.);
      }
    });

    // âœ… Upload real nÃ« Firebase Storage (shumÃ« foto)
    uploadBtn.addEventListener("click", async () => {
      const files = Array.from(fileInput.files || []);
      if (files.length === 0) {
        setMsg("âŒ Zgjidh foto fillimisht.");
        return;
      }

      try {
        setBusy(true);
        setMsg("â³ Duke ngarkuar... 0/" + files.length);

        const urls = [];
        for (let i = 0; i < files.length; i++) {
          const file = files[i];

          // emÃ«r unik
          const uniqueName = ${Date.now()}_${Math.random().toString(16).slice(2)}_${file.name};

          // rruga nÃ« storage
          const storageRef = ref(storage, photos/${uniqueName});

          // upload
          await uploadBytes(storageRef, file);

          // url publike (download url)
          const url = await getDownloadURL(storageRef);
          urls.push(url);

          setMsg(â³ Duke ngarkuar... ${i + 1}/${files.length});
        }

        uploadedUrls = urls;
        setMsg(âœ… Upload OK!\nU ngarkuan: ${uploadedUrls.length} foto.\nTani shtyp â€œPUBLISHâ€.);
      } catch (err) {
        console.error(err);
        setMsg("âŒ DÃ«shtoi upload.\nShiko Console (Inspect) pÃ«r gabimin.");
      } finally {
        setBusy(false);
      }
    });

    // âœ… Publish = ruaj nÃ« Firestore listÃ«n e URL-ve
    publishBtn.addEventListener("click", async () => {
      if (uploadedUrls.length === 0) {
        setMsg("âŒ SÃ« pari bÃ«j â€˜NGARKO FOTOTâ€™ qÃ« tÃ« krijohen URL-tÃ«.");
        return;
      }

      try {
        setBusy(true);
        setMsg("â³ Duke publikuar...");

        // ndrysho emrin e koleksionit sipas qejfit
        await addDoc(collection(db, "posts"), {
          photoUrls: uploadedUrls,
          createdAt: serverTimestamp()
        });

        setMsg("ğŸš€ Publish OK!\nPosti u ruajt nÃ« Firestore.");
        // opsionale: pastro zgjedhjen
        fileInput.value = "";
        uploadedUrls = [];
      } catch (err) {
        console.error(err);
        setMsg("âŒ DÃ«shtoi publish.\nShiko Console (Inspect) pÃ«r gabimin.");
      } finally {
        setBusy(false);
      }
    });
  </script>
</body>
</html>

